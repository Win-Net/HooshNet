{% extends "admin/base.html" %}

{% block page_title %}ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…{% endblock %}
{% block page_subtitle %}Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø³ÛŒØ³ØªÙ…{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="grid-2" style="gap: var(--sp-xl);">
        <!-- General Settings -->
        <div class="card">
            <div class="card-header"
                style="margin-bottom: var(--sp-md); padding-bottom: var(--sp-md); border-bottom: 1px solid var(--border-color);">
                <div style="font-weight: 800; display: flex; align-items: center; gap: var(--sp-sm);">
                    <i class="fas fa-cog" style="color: var(--p-primary);"></i>
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: var(--sp-md);">
                <div class="setting-item">
                    <div style="display: flex; gap: var(--sp-md); align-items: center;">
                        <div
                            style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div style="font-weight: 700;">Ù†Ø§Ù… Ø±Ø¨Ø§Øª</div>
                            <div style="font-size: 0.8rem; color: var(--p-text-muted);">Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ Ø±Ø¨Ø§Øª Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù…</div>
                        </div>
                    </div>
                    <div style="font-family: monospace; font-weight: 700;">{{ bot_username or 'Ù†Ø§Ù…Ø´Ø®Øµ' }}</div>
                </div>

                <div class="setting-item">
                    <div style="display: flex; gap: var(--sp-md); align-items: center;">
                        <div
                            style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div>
                            <div style="font-weight: 700;">Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†</div>
                            <div style="font-size: 0.8rem; color: var(--p-text-muted);">Ø¢ÛŒØ¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ</div>
                        </div>
                    </div>
                    <div style="font-family: monospace; font-weight: 700;">{{ admin_id or 'Ù†Ø§Ù…Ø´Ø®Øµ' }}</div>
                </div>

                <div class="setting-item">
                    <div style="display: flex; gap: var(--sp-md); align-items: center;">
                        <div
                            style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div>
                            <div style="font-weight: 700;">Ø¢Ø¯Ø±Ø³ ÙˆØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</div>
                            <div style="font-size: 0.8rem; color: var(--p-text-muted);">Ø¢Ø¯Ø±Ø³ Ø§ØµÙ„ÛŒ ÙˆØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</div>
                        </div>
                    </div>
                    <div style="font-family: monospace; font-weight: 700; direction: ltr;">{{ webapp_url or 'ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡'
                        }}</div>
                </div>
            </div>
        </div>



        <!-- Theme Settings -->
        <div class="card">
            <div class="card-header"
                style="margin-bottom: var(--sp-md); padding-bottom: var(--sp-md); border-bottom: 1px solid var(--border-color);">
                <div style="font-weight: 800; display: flex; align-items: center; gap: var(--sp-sm);">
                    <i class="fas fa-palette" style="color: var(--p-accent);"></i>
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¸Ø§Ù‡Ø±
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: var(--sp-md);">
                <div class="setting-item">
                    <div style="display: flex; gap: var(--sp-md); align-items: center;">
                        <div
                            style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                            <i class="fas fa-paint-brush"></i>
                        </div>
                        <div>
                            <div style="font-weight: 700;">ØªÙ… Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ</div>
                            <div style="font-size: 0.8rem; color: var(--p-text-muted);">Ø§Ù†ØªØ®Ø§Ø¨ Ø¸Ø§Ù‡Ø± Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ</div>
                        </div>
                    </div>
                    <select id="themeSelect" onchange="changeTheme(this.value)"
                        style="padding: 5px 10px; border-radius: 5px; background: var(--p-bg-card); color: var(--p-text-main); border: 1px solid var(--border-color);">
                        <option value="default" {% if current_theme=='default' %}selected{% endif %}>Ù¾ÛŒØ´â€ŒÙØ±Ø¶</option>
                        <option value="modern" {% if current_theme=='modern' %}selected{% endif %}>Ù…Ø¯Ø±Ù† (Modern) ğŸ’
                        </option>
                    </select>
                </div>
            </div>
        </div>

        <script>
            async function changeTheme(theme) {
                try {
                    const response = await fetch('/admin/settings/theme', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ theme: theme })
                    });
                    const data = await response.json();

                    if (data.success) {
                        showToast(data.message, 'success');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        showToast(data.message, 'error');
                    }
                } catch (error) {
                    showToast('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                }
            }
        </script>

        <!-- Database Settings -->
        <div class="card">
            <div class="card-header"
                style="margin-bottom: var(--sp-md); padding-bottom: var(--sp-md); border-bottom: 1px solid var(--border-color);">
                <div style="font-weight: 800; display: flex; align-items: center; gap: var(--sp-sm);">
                    <i class="fas fa-database" style="color: var(--p-info);"></i>
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ùˆ Ø¨Ú©Ø§Ù¾
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: var(--sp-md);">
                <div class="setting-item">
                    <div style="display: flex; gap: var(--sp-md); align-items: center;">
                        <div
                            style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div>
                            <div style="font-weight: 700;">ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„</div>
                            <div style="font-size: 0.8rem; color: var(--p-text-muted);">ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</div>
                        </div>
                    </div>
                    <span class="badge badge-success">Ù…ØªØµÙ„</span>
                </div>

                <div class="setting-item" style="flex-direction: column; align-items: stretch; gap: var(--sp-md);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; gap: var(--sp-md); align-items: center;">
                            <div
                                style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div>
                                <div style="font-weight: 700;">Ø¨Ú©Ø§Ù¾ Ø®ÙˆØ¯Ú©Ø§Ø±</div>
                                <div style="font-size: 0.8rem; color: var(--p-text-muted);">ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ‡ÛŒÙ‡ Ù†Ø³Ø®Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
                                </div>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="autoBackupToggle" onchange="toggleAutoBackup()">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <div id="backupSettings"
                        style="display: none; padding-top: var(--sp-sm); border-top: 1px solid var(--border-color);">
                        <div
                            style="display: grid; grid-template-columns: 1fr auto; gap: var(--sp-md); align-items: center;">
                            <label style="font-size: 0.9rem;">Ø¨Ø§Ø²Ù‡â€ŒÛŒ Ø²Ù…Ø§Ù†ÛŒ Ø¨Ú©Ø§Ù¾â€ŒÚ¯ÛŒØ±ÛŒ:</label>
                            <select id="backupFrequency" onchange="saveBackupSettings()"
                                style="padding: 5px 10px; border-radius: 5px; background: var(--p-bg-card); color: var(--p-text-main); border: 1px solid var(--border-color);">
                                <option value="1">Ù‡Ø± Û± Ø³Ø§Ø¹Øª</option>
                                <option value="6">Ù‡Ø± Û¶ Ø³Ø§Ø¹Øª</option>
                                <option value="12">Ù‡Ø± Û±Û² Ø³Ø§Ø¹Øª</option>
                                <option value="24">Ø±ÙˆØ²Ø§Ù†Ù‡ (Û²Û´ Ø³Ø§Ø¹Øª)</option>
                                <option value="168">Ù‡ÙØªÚ¯ÛŒ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Load initial settings
            document.addEventListener('DOMContentLoaded', loadBackupSettings);

            async function loadBackupSettings() {
                try {
                    const response = await fetch('/admin/settings/backup');
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('autoBackupToggle').checked = data.enabled;
                        document.getElementById('backupFrequency').value = data.frequency || 24;
                        toggleBackupVisibility(data.enabled);
                    }
                } catch (error) {
                    console.error('Error loading backup settings:', error);
                }
            }

            function toggleBackupVisibility(enabled) {
                const settingsDiv = document.getElementById('backupSettings');
                settingsDiv.style.display = enabled ? 'block' : 'none';
            }

            async function toggleAutoBackup() {
                const enabled = document.getElementById('autoBackupToggle').checked;
                toggleBackupVisibility(enabled);
                await saveBackupSettings();
            }

            async function saveBackupSettings() {
                const enabled = document.getElementById('autoBackupToggle').checked;
                const frequency = document.getElementById('backupFrequency').value;

                try {
                    const response = await fetch('/admin/settings/backup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            enabled: enabled,
                            frequency: parseInt(frequency)
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        showToast('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ú©Ø§Ù¾ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                    } else {
                        showToast('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'error');
                    }
                } catch (error) {
                    showToast('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                }
            }
        </script>

        <style>
            /* Switch styles */
            .switch {
                position: relative;
                display: inline-block;
                width: 50px;
                height: 24px;
            }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .4s;
            }

            .slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
            }

            input:checked+.slider {
                background-color: var(--p-success);
            }

            input:focus+.slider {
                box-shadow: 0 0 1px var(--p-success);
            }

            input:checked+.slider:before {
                transform: translateX(26px);
            }

            .slider.round {
                border-radius: 24px;
            }

            .slider.round:before {
                border-radius: 50%;
            }
        </style>

        <!-- System Info -->
        <div class="card">
            <div class="card-header"
                style="margin-bottom: var(--sp-md); padding-bottom: var(--sp-md); border-bottom: 1px solid var(--border-color);">
                <div style="font-weight: 800; display: flex; align-items: center; gap: var(--sp-sm);">
                    <i class="fas fa-info-circle" style="color: var(--p-warning);"></i>
                    Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: var(--sp-md);">
                <div class="setting-item">
                    <div style="display: flex; gap: var(--sp-md); align-items: center;">
                        <div
                            style="width: 40px; height: 40px; border-radius: var(--radius-md); background: var(--p-bg-hover); display: flex; align-items: center; justify-content: center; color: var(--p-text-muted);">
                            <i class="fas fa-code-branch"></i>
                        </div>
                        <div>
                            <div style="font-weight: 700;">Ù†Ø³Ø®Ù‡ Ù¾Ù†Ù„</div>
                            <div style="font-size: 0.8rem; color: var(--p-text-muted);">Ù†Ø³Ø®Ù‡ ÙØ¹Ù„ÛŒ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</div>
                        </div>
                    </div>
                    <span class="badge badge-secondary">v1.0.0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--sp-sm);
        background: var(--p-bg-hover);
        border-radius: var(--radius-lg);
        border: 1px solid transparent;
        transition: border-color 0.2s ease;
    }

    .setting-item:hover {
        border-color: var(--border-color);
    }
</style>
{% endblock %}